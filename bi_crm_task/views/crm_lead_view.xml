<odoo>
	<data>
		
		<record id="view_crm_task_form" model="ir.ui.view">
            <field name="name">crm.task.wizard</field>
            <field name="model">crm.task.wizard</field>
            <field name="arch" type="xml">
                <form string="Créer une tâche">
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Project Task"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="project_id" domain="[('active', '=', True)]" context="{'default_use_tasks':1}"/>
                            <!-- <field name="user_ids" class="o_task_user_field" options="{'no_open': True}" readonly="1" widget="many2many_avatar_user"/> -->
                        </group>
                        <group>
                            <label for="planned_date_begin" string="Date planifié désiré"/>
                            <div class="w-100">
                                <div class="o_row">
                                    <field name="planned_date_begin" widget="daterange" options="{'related_end_date': 'planned_date_end'}" attrs="{'required': [('planned_date_end', '!=', False)]}"/>
                                    <i class="fa fa-long-arrow-right mx-2 oe_edit_only" aria-label="Arrow icon" title="Arrow"/>
                                    <i class="fa fa-long-arrow-right mx-2 oe_read_only" aria-label="Arrow icon" title="Arrow"/>
                                    <field name="planned_date_end" widget="daterange" options="{'related_start_date': 'planned_date_begin'}" attrs="{'required': [('planned_date_begin', '!=', False)]}"/>
                                </div>
                            </div>
                        </group>
                    </group>
                    <footer>
                    	<button name="create_task" string="Créer une tâche" type="object"/>
                    </footer>
                </form>
            </field>
        </record>

        <record id="action_view_crm_task_form" model="ir.actions.act_window">
            <field name="name">Create Task</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">crm.task.wizard</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_crm_task_form"/>
            <field name="target">new</field>
        </record>

        <record id="bfal_view_task_tree" model="ir.ui.view">
            <field name="name">bfal_view_task_tree</field>
            <field name="model">project.task</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <tree string="Tasks" multi_edit="1" sample="1" js_class="project_task_list">
                    <field name="message_needaction" invisible="1" readonly="1"/>
                    <field name="is_closed" invisible="1" />
                    <field name="sequence" invisible="1" readonly="1"/>
                    <field name="allow_milestones" invisible="1"/>
                    <field name="priority" widget="priority" optional="show" nolabel="1"/>
                    <field name="allow_subtasks" invisible="1"/>
                    <field name="name" widget="name_with_subtask_count"/>
                    <field name="project_id" widget="project_private_task" optional="show" readonly="1" options="{'no_open': 1}"/>
                    <field name="partner_id"/>
                    <field name="parent_id" optional="hide" attrs="{'invisible': [('allow_subtasks', '=', False)]}" groups="base.group_no_one"/>
                    <field name="user_ids" widget="many2many_avatar_user" domain="[('share', '=', False), ('active', '=', True)]" options='{"no_quick_create": True}'/>
                    <field name="progress" widget="progressbar"/>
                    <field name="branch_id" />
                    <field name="company_id" groups="base.group_multi_company" optional="show" readonly="True"/>
                    <field name="company_id" invisible="1"/>
                    <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}" optional="show" context="{'project_id': project_id}"/>
                    <field name="rating_active" invisible="1"/>
                    <field name="rating_last_text" string="Rating" decoration-danger="rating_last_text == 'ko'"
                        decoration-warning="rating_last_text == 'ok'" decoration-success="rating_last_text == 'top'"
                        attrs="{'invisible': ['|', ('rating_active', '=', False), ('rating_last_text', '=', 'none')]}"
                        class="fw-bold" widget="badge" optional="hide" groups="project.group_project_rating"/>
                    <field name="legend_normal" invisible="1"/>
                    <field name="legend_done" invisible="1"/>
                    <field name="legend_blocked" invisible="1"/>
                    <field name="kanban_state" widget="state_selection" optional="show" options="{'hide_label': True}" nolabel="1" required="0"/>
                    <field name="stage_id" invisible="context.get('set_visible',False)" optional="show" readonly="not context.get('default_project_id')"/>
                    <field name="recurrence_id" invisible="1" />
                </tree>
            </field>
        </record>
		
		<record id="action_view_task_id" model="ir.actions.act_window">
            <field name="name">Tasks</field>
            <field name="res_model">project.task</field>
            <field name="view_mode">tree,kanban,form,calendar,pivot,graph</field>
            <field name="domain">[('lead_id', '=', active_id)]</field>
            <field name="context">{'search_default_lead_id': active_id, 'default_lead_id': active_id}</field>
            <field name="view_id" eval="ref(bfal_view_task_tree)"/>
            <field name="help" type="html">
                <p>
                    Odoo's project management allows you to manage the pipeline of your tasks efficiently. You can track progress, discuss on tasks, attach documents, etc.
                </p>
            </field>
        </record>
		
		
		<record id="crm_inherit_form" model="ir.ui.view">
			<field name="name">Crm Lead</field>
			<field name="model">crm.lead</field>
			<field name="inherit_id" ref="crm.crm_lead_view_form" />
			<field name="arch" type="xml">
			<div name="button_box" position="inside">
				<button class="oe_stat_button" type="action" name="%(action_view_task_id)d"
                        context="{'default_partner_id': partner_id }"
                        icon="fa-tasks">
                        <field  string="Tâches" name="task_number" widget="statinfo"/>
                    </button>
                  </div>
				<!-- <button name="%(crm.action_crm_lead2opportunity_partner)d" position="after">
					<button name="%(action_view_crm_task_form)d" string="Créer une tâche" type="action"/>
				</button> -->
			</field>
		</record>
	</data>
</odoo>
        
        